<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>D&D Voucher Digital</title>
  <style>
    :root{
      --bg:#0b0f16;
      --card:#111a26;
      --muted:#9fb0c7;
      --txt:#eaf2ff;
      --stroke:rgba(255,255,255,.10);
      --acc:#7c5cff;
      --acc2:#2bd4ff;
      --good:#2bd46f;
      --bad:#ff4d6d;
      --glass:rgba(255,255,255,.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:radial-gradient(1200px 700px at 10% -10%, rgba(124,92,255,.25), transparent 60%),
      radial-gradient(900px 600px at 110% 10%, rgba(43,212,255,.18), transparent 55%),
      var(--bg);
      color:var(--txt);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      min-height:100vh;
    }
    .wrap{max-width:980px;margin:0 auto;padding:16px 16px 88px}
    .top{
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;margin-top:10px;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:42px;height:42px;border-radius:12px;
      background:linear-gradient(135deg, rgba(124,92,255,.95), rgba(43,212,255,.8));
      box-shadow:0 10px 30px rgba(124,92,255,.25);
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.16);
    }
    .brand h1{font-size:22px;line-height:1.1;margin:0}
    .brand small{display:block;color:var(--muted);margin-top:2px}
    .icons{display:flex;gap:10px}
    .iconBtn{
      width:44px;height:44px;border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.05);
      color:var(--txt);
      display:grid;place-items:center;
    }
    .tabs{
      display:flex;gap:12px;justify-content:flex-start;align-items:center;
      margin:14px 0 12px;
    }
    .pill{
      flex:1;
      padding:12px 14px;border-radius:20px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      color:var(--txt);
      display:flex;gap:10px;align-items:center;justify-content:center;
      font-weight:650;
      user-select:none;
    }
    .pill.active{
      background:linear-gradient(135deg, rgba(124,92,255,.25), rgba(43,212,255,.10));
      border-color:rgba(124,92,255,.35);
      box-shadow:0 12px 28px rgba(124,92,255,.18);
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--stroke);
      border-radius:22px;
      padding:16px;
      box-shadow:0 18px 40px rgba(0,0,0,.35);
    }
    .hint{color:var(--muted);margin:0 0 12px;font-size:13px}
    label{display:block;color:var(--muted);font-weight:650;margin:12px 0 8px}
    input,select{
      width:100%;
      padding:14px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.05);
      color:var(--txt);
      outline:none;
      font-size:15px;
    }
    input::placeholder{color:rgba(159,176,199,.6)}
    .sub{font-size:12px;color:rgba(159,176,199,.75);margin-top:6px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:720px){.grid2{grid-template-columns:1fr}}
    .priceBox{
      margin-top:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      padding:14px;
      display:flex;gap:12px;justify-content:space-between;align-items:flex-end;
    }
    .priceBox small{color:var(--muted);display:block;margin-bottom:4px}
    .priceBox b{font-size:22px}
    .btnRow{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
    .btn{
      width:100%;
      padding:15px 16px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(135deg, rgba(124,92,255,.95), rgba(43,212,255,.65));
      color:#0b0f16;
      font-weight:900;
      font-size:16px;
      cursor:pointer;
      position:relative;
      z-index:9999; /* anti ketiban overlay */
      pointer-events:auto; /* anti keblok style */
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{transform:scale(.99)}
    .btn.secondary{
      background:rgba(255,255,255,.05);
      color:var(--txt);
    }
    .btn[disabled]{opacity:.5;cursor:not-allowed;filter:grayscale(1)}
    .nav{
      position:fixed;left:0;right:0;bottom:0;
      padding:10px 14px;
      background:rgba(10,14,22,.72);
      border-top:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
      z-index:9998;
    }
    .navIn{max-width:980px;margin:0 auto;display:flex;gap:10px}
    .navBtn{
      flex:1;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      padding:12px 10px;
      background:rgba(255,255,255,.04);
      color:var(--txt);
      font-weight:750;
    }
    /* Debug */
    .debug{
      margin-top:12px;
      border-radius:16px;
      padding:12px;
      border:1px dashed rgba(255,255,255,.20);
      background:rgba(0,0,0,.18);
      font-family:ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size:12px;
      color:#d7e6ff;
      max-height:170px;
      overflow:auto;
    }
    .ok{color:var(--good)}
    .err{color:var(--bad)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">üéüÔ∏è</div>
        <div>
          <small>D&D</small>
          <h1>Voucher Digital</h1>
        </div>
      </div>
      <div class="icons">
        <button class="iconBtn" type="button" title="WhatsApp">üü¢</button>
        <button class="iconBtn" type="button" title="Mode">üåô</button>
      </div>
    </div>

    <div class="tabs">
      <div class="pill">‚ùî Cara Order</div>
      <div class="pill active">‚ö° Order Now</div>
      <div class="pill">üéß Admin</div>
    </div>

    <div class="card">
      <p class="hint">Isi form, pastikan qty min 12, lalu pilih metode pembayaran.</p>

      <label>Nama</label>
      <input id="name" placeholder="Nama lengkap" value="ALEX"/>

      <label>Email</label>
      <input id="email" type="email" placeholder="email@gmail.com" value=""/>

      <label>No HP</label>
      <input id="phone" inputmode="numeric" placeholder="08xxxxxxxxxx" value=""/>
      <div class="sub">No HP pembeli (buat konfirmasi jika diperlukan). Tidak ditampilkan publik.</div>

      <label>Qty Order (min 12)</label>
      <input id="qty" type="number" min="1" step="1" value="12"/>
      <div id="qtyHint" class="sub">Qty valid. Tombol order sudah aktif.</div>

      <div class="grid2">
        <div>
          <label>Redeem</label>
          <select id="redeem">
            <option value="Alfamart">Alfamart</option>
            <option value="Indomaret">Indomaret</option>
          </select>
        </div>
        <div>
          <label>Produk</label>
          <select id="product">
            <option value="Frestea Blackcurrant 500ml|1500">Frestea Blackcurrant 500ml (Rp 1.500)</option>
            <option value="Sprite Zero 390ml|1500">Sprite Zero 390ml (Rp 1.500)</option>
          </select>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>Payment</label>
          <select id="payment">
            <option value="QRIS">QRIS</option>
            <option value="Transfer">Transfer</option>
            <option value="Tunai">Tunai</option>
          </select>
        </div>
        <div>
          <label>Catatan (opsional)</label>
          <input id="note" placeholder="Contoh: kirim cepat ya"/>
        </div>
      </div>

      <div class="priceBox">
        <div>
          <small>Harga / Voucher</small>
          <b id="price">Rp 1.500</b>
        </div>
        <div style="text-align:right">
          <small>Total Pembayaran</small>
          <b id="total">Rp 18.000</b>
        </div>
      </div>
      <div class="sub">Total otomatis dihitung dari Qty √ó Harga/voucher.</div>

      <!-- INI KUNCI: onclick inline biar pasti kebaca -->
      <div class="btnRow">
        <button id="btnOrder" class="btn" type="button" onclick="submitOrder()">‚ö° Buat Order</button>
        <button class="btn secondary" type="button" onclick="resetForm()">‚Ü©Ô∏è Reset</button>
      </div>

      <div id="debug" class="debug"></div>
    </div>
  </div>

  <div class="nav">
    <div class="navIn">
      <button class="navBtn" type="button">üè† Beranda</button>
      <button class="navBtn" type="button">‚ùî Cara</button>
      <button class="navBtn" type="button">‚ö° Order</button>
      <button class="navBtn" type="button">üü¢ Admin</button>
    </div>
  </div>

<script>
  // ====== SET URL WEBAPP APPS SCRIPT LU DI SINI ======
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbx8gaBxDEEFDXRnYSeHVIraC480UP-UW-wEcoZwYmQTcKKRabJ9T2N80Bfg4l8C2LStBw/exec";
  // ===================================================

  const $ = (id)=>document.getElementById(id);

  function rupiah(n){
    n = Number(n||0);
    return "Rp " + n.toLocaleString("id-ID");
  }

  function logLine(text, type){
    const el = $("debug");
    const line = document.createElement("div");
    line.innerHTML = (type==="ok" ? "‚úÖ " : type==="err" ? "‚ùå " : "‚Ä¢ ") + text;
    if(type==="ok") line.className="ok";
    if(type==="err") line.className="err";
    el.prepend(line);
  }

  function calc(){
    const qty = Number($("qty").value || 0);
    const [prodName, priceStr] = $("product").value.split("|");
    const price = Number(priceStr || 0);
    const total = qty * price;

    $("price").textContent = rupiah(price);
    $("total").textContent = rupiah(total);

    if(qty >= 12){
      $("qtyHint").textContent = "Qty valid. Tombol order sudah aktif.";
      $("btnOrder").disabled = false;
      $("qtyHint").style.color = "#7CFFA8";
    }else{
      $("qtyHint").textContent = "Qty kurang. Minimal 12.";
      $("btnOrder").disabled = true;
      $("qtyHint").style.color = "#ff9bb0";
    }
  }

  // Trigger kalkulasi
  ["qty","product"].forEach(id=>{
    $(id).addEventListener("input", calc);
    $(id).addEventListener("change", calc);
  });
  window.addEventListener("load", ()=>{
    logLine("Loaded. Kalau tombol dipencet harus muncul log 'CLICK OK'.");
    calc();
  });

  function resetForm(){
    $("name").value="";
    $("email").value="";
    $("phone").value="";
    $("qty").value="12";
    $("redeem").value="Alfamart";
    $("product").selectedIndex=0;
    $("payment").value="QRIS";
    $("note").value="";
    $("debug").innerHTML="";
    logLine("Reset OK");
    calc();
  }

  async function submitOrder(){
    // bukti klik kepencet
    logLine("CLICK OK (tombol kepencet).");

    const qty = Number($("qty").value || 0);
    if(qty < 12){
      logLine("Qty < 12, dibatalin.", "err");
      return;
    }

    const [productName, priceStr] = $("product").value.split("|");
    const price = Number(priceStr||0);
    const total = qty * price;

    // payload sesuai Apps Script doGet(action=order)
    const payload = {
      action: "order",
      time: new Date().toISOString(),
      name: $("name").value.trim(),
      email: $("email").value.trim(),
      phone: $("phone").value.trim(),
      redeem: $("redeem").value,
      qty: String(qty),
      price: String(price),
      total: String(total),
      payment: $("payment").value,
      note: $("note").value.trim(),
      product: productName
    };

    // kirim pakai GET query string (paling aman di HP)
    const qs = new URLSearchParams(payload).toString();
    const url = WEBAPP_URL + "?" + qs;

    logLine("Request: " + url);

    $("btnOrder").disabled = true;
    $("btnOrder").textContent = "‚è≥ Mengirim...";

    try{
      const res = await fetch(url, { method:"GET", mode:"cors" });
      const text = await res.text();
      logLine("Response raw: " + text);

      let json;
      try{ json = JSON.parse(text); }catch(e){ json = {ok:false,error:"response bukan JSON"}; }

      if(json.ok){
        logLine("ORDER SUKSES ‚úî", "ok");
        alert("Terkirim! Admin akan approve secepatnya.");
      }else{
        logLine("ORDER GAGAL: " + (json.error||"unknown"), "err");
        alert("Gagal: " + (json.error||"unknown"));
      }
    }catch(err){
      logLine("FETCH ERROR: " + err, "err");
      alert("Fetch error: " + err);
    }finally{
      $("btnOrder").disabled = false;
      $("btnOrder").textContent = "‚ö° Buat Order";
      calc();
    }
  }
</script>
</body>
</html>
